## 说明

> 本脚本仅适用于自用，敬请外部人员不要使用，谢谢。
>
> 本脚本是用于堡垒机的自动登录、跳板机的自动登录、网厅信息注入及其他功能。需要事先配置方可使用。
>
> **重要提示：** 使用前请仔细阅读本说明文档，确保理解所有功能和配置要求。本脚本涉及敏感信息处理，请务必注意信息安全。

## 1. 安装

> 取自知乎《[Tampermonkey油猴插件——安装与使用教程](https://zhuanlan.zhihu.com/p/128453110)》一文，不明白可以点击链接直接跳转。

### 1.1 介绍

相信熟悉浏览器的都知道，尤其是大名鼎鼎的Chrome浏览器，丰富的扩展程序让很多人体验到了浏览器的神奇之处，而一个没有安装扩展程序的浏览器也是不完整的。

而在众多的扩展中，就不得不提到一个浏览器插件——**Tampermonkey**。中文俗称油猴。

相信很多人也听说过，大家可以把他理解为一个用户脚本管理器。它本身是无法为我们发挥什么作用的，它主要依靠各大社区编写的扩展脚本（JavaScript代码）运行在浏览器上，来改变被访问网页的功能，提升我们的网页浏览体验。

### 1.2 **插件安装**

方法一：

> ①直接百度手动搜索进入**[Tampermonkey官网](https://www.tampermonkey.net/)**。
>
> ![img](https://howe-pic-bed.oss-cn-beijing.aliyuncs.com/picbed/v2-da820e2e2e3eede3d41f1572ff81533b_r.jpg)
>
> Tampermonkey Stable为正式版，Tampermonkey Beta为测试版
>
> 点击**下载**，页面跳转至Edge外接扩展商店的安装页面，我们直接**获取**安装就好了，如下图。
>
> ![img](https://howe-pic-bed.oss-cn-beijing.aliyuncs.com/picbed/v2-997cba084102d92b7dbc8f3139c0eb48_r.jpg)
>
> Edge以外的其他浏览器点击下载则会跳转至**[chrome 网上应用店](https://chrome.google.com/webstore/category/extensions)**，正常情况下咱们是打不开的，需要科学上网才可以打开。
>
> ②或者，很多浏览器里也贴心的自带有相应的扩展市场，我们也可以直接在其扩展应用市场之类的地方直接安装。
>
> ![img](https://howe-pic-bed.oss-cn-beijing.aliyuncs.com/picbed/v2-e9bdff9569fda02991355c278e6bba70_r.jpg)
>
> 360浏览器应用市场

方法二：

> 考虑到文明上网的普及问题，非Edge以外的其他浏览器，我们也可以在很多渠道获取[Tampermonkey的crx文件（点击下载）](https://wmhl.lanzoui.com/ib8glab)，将下载下来的压缩包解压出来，其中类型为**CRX文件**就是接下来需要用到的安装文件。
>
> 打开浏览器**设置，**打开**扩展程序**页面，或者直接搜索**Chrome://extensions/**进入。然后保持页面**开发者模式**的开启。找到被解压后的tampermonkey.crx文件，将其拖动到**扩展程序**页面，释放并同意完成安装。
>
> ![img](https://howe-pic-bed.oss-cn-beijing.aliyuncs.com/picbed/v2-947ceb4ff0dd70cc7f240cf8ba822b5d_r.jpg)
>
> 成功安装后会弹出这个窗口，页面右上角也会出现油猴扩展的logo。
>
> ![img](https://howe-pic-bed.oss-cn-beijing.aliyuncs.com/picbed/v2-95ed908003b4c0702242b593a20da1b7_r.jpg)
>
> 不同浏览器所支持的扩展及安装过程可能略有出入，这里呢就主要以我的情况来介绍，不过**理论上支持chrome内核的其他浏览器都是可以安装的。**

### 1.3 安装本脚本

打开本页面[跳板机登录](https://greasyfork.org/zh-CN/scripts/454620-%E8%B7%B3%E6%9D%BF%E6%9C%BA%E7%99%BB%E5%BD%95)
,点击绿色的安装按钮，版本可能不一致，但是位置都是这里。我的是已经安装完成了，所以显示重新安装。

![image-20221114154953574](https://howe-pic-bed.oss-cn-beijing.aliyuncs.com/picbed/image-20221114154953574.png)

安装完后，大工告成

## 2. 功能说明

### 2.1 主要功能

该脚本提供以下主要功能：

1. **堡垒机自动登录**：
   - 自动识别登录界面并填充用户名密码
   - 自动点击登录按钮
   - 支持多账号配置
   - 登录状态提示

2. **跳板机自动登录**：
   - 根据配置的IP地址自动查找对应的跳板机
   - 自动填充用户名密码
   - 自动处理弹窗登录
   - 登录结果提示
   - 最大重试20次

3. **Console自动登录**：
   - 支持账户登录和子用户登录自动切换
   - 自动填充用户名、邮箱和密码
   - 自动勾选"记住登录"选项
   - 自动点击登录按钮
   - 登录状态提示

4. **单位信息查看**：
   - 显示单位基本信息（从InsuEmpInfo获取）
   - 显示是否参保状态（isInsured）
   - 显示是否上传承诺书（isUploadCommitment）
   - 显示访问令牌信息（支持加密和解密显示）
   - 支持信息表格化展示

### 2.2 使用方式

1. **悬浮按钮**：
   - 位置：页面右下角显示⮟图标
   - 拖拽功能：
     * 支持鼠标拖动到页面任意位置
     * 拖动时显示半透明效果
   - 点击操作：
     * 点击显示/隐藏登录项列表
   - 样式效果：
     * 正常：蓝色背景
     * 鼠标悬停：深蓝色
     * 拖动中：半透明

2. **登录项管理**：
   - 添加/编辑登录项：
     * 点击设置按钮打开管理面板
     * 填写显示名称（可选）
     * 填写用户名和密码
     * 根据类型填写其他必要信息
     * 保存即时生效
   
   - 删除登录项：
     * 在管理面板中点击删除按钮
     * 删除后自动更新列表

3. **单位信息查看**：
   - 查看方式：
     * 点击登录列表中的"📋 查看单位信息"
     * 显示弹窗形式的信息表格
   
   - 信息类别：
     * 显示字段名称
     * 显示字段说明
     * 显示字段值
   
   - 特殊信息：
     * 显示参保状态
     * 显示承诺书上传状态
     * 显示访问令牌（支持加密和解密显示）

### 2.3 配置说明

根据登录类型，需要配置不同的信息：

1. **堡垒机登录**配置项：
   - **必填项**：
     * 用户名：登录用的账号
     * 密码：账号对应的密码
   - **选填项**：
     * 显示名称：用于在列表中显示
   - **登录元素**：
     * 用户名输入框：name="username"
     * 密码输入框：name="pwd"
     * 登录按钮：包含"登录"文本的按钮

2. **跳板机登录**配置项：
   - **必填项**：
     * 用户名：登录账号
     * 密码：账号密码
     * IP地址：跳板机的IP地址（用于匹配）
   - **选填项**：
     * 显示名称：在列表中显示的名称
   - **其他特性**：
     * 自动重试：最多20次
     * 定时检查：200ms间隔

3. **Console登录**配置项：
   - **必填项**：
     * 用户名：登录账号
     * 密码：账号密码
     * 电子邮箱：必填项
   - **选填项**：
     * 显示名称：在列表中显示的名称
   - **自动行为**：
     * 自动切换到子用户登录（如需要）
     * 自动勾选"记住登录"选项
     * 自动点击登录按钮

4. **存储说明**：
   - 登录信息使用`GM_getValue`和`GM_setValue`存储
   - 使用JSON格式保存配置
   - 支持列表形式的多账号管理
   - 密码使用AES-ECB加密存储

## 3. 安全说明

1. **数据存储安全**：
   - 使用油猴脚本的存储API（GM_getValue/GM_setValue）
   - 密码采用AES-ECB加密算法（CryptoJS）
   - 所有数据存储在本地浏览器中
   
2. **运行环境限制**：
   - 仅在指定网站上运行（@include配置）
   - 仅在文档加载完成后执行（document-end）
   - 使用严格模式（'use strict'）

3. **密码保护**：
   - 密码显示为掩码
   - 使用固定密钥加密：
     * 普通加密密钥：i1dS4PJXv612krF0
     * 令牌加密密钥：SiIiqxyoDXuxbnGv

4. **使用建议**：
   - 定期更新密码
   - 不要在公共设备上保存
   - 及时更新配置信息
   - 定期检查登录记录

## 4. 更新日志

### v1.0 (2025-10-09)
- **基础功能**：
  * 支持堡垒机自动登录
  * 支持跳板机自动登录
  * 支持Console自动登录
  * 添加单位信息查看功能

- **用户界面**：
  * 实现可拖拽悬浮按钮
  * 添加登录项列表管理
  * 添加设置管理界面
  * 添加单位信息展示

- **技术特性**：
  * 使用AES-ECB加密存储密码
  * 支持JSON格式的配置管理
  * 添加登录状态提示
  * 实现自动重试机制

### 依赖说明
- jquery v3.7.1
- sweetalert2 v11.14.5
- crypto-js v4.2.0
- keymaster v1.6.1
- jquery-cookie v1.4.1